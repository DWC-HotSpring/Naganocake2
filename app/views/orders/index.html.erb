<div class="container">
  <div class="row">
    <h2>注文履歴一覧</h2>
  </div>

  <table class="table table-bordered">

    <thead>
      <tr>
        <th>注文日</th>
        <th>配送先</th>
        <th>注文商品</th>
        <th>支払金額</th>
        <th>ステータス</th>
        <th>注文詳細</th>
      </tr>
    </thead>

    <tbody>
      <% @orders.each do |order| %>
      <tr>
        <td><%= order.created_at.strftime('%Y/%m/%d') %></td>
        <td>
            <%= order.post_code %><br>
            <%= order.prefecture_name %><%= order.city %><%= order.block %><br>
            <%= order.addressee %>
        </td>
        <td>
          <% sum_all = 0 %>
          <% order.order_products.each do |order_product| %>
          <%= order_product.product.name %><br>
          <% sub_total = order_product.purchase_price.to_i * order_product.quantity %>
          <% sum_all += sub_total.to_i %>
          <% end %>
        </td>
        <td>
          <%= sum_all += order.postage.to_i %>円
        </td>
        <td>
          <%= order.order_status %>
        </td>
        <td>
          <%= link_to '表示する', order_path(order), class: "btn btn-primary" %>
        </td>
      </tr>
      <% end %>
    </tbody>

  </table>

</div>